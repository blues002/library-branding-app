<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‘ì€ë„ì„œê´€ ë¸Œëœë“œ ì„¸íŒ…</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- html2canvas (Image Save) -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        /* Inter í°íŠ¸ ê¸°ë³¸ ì ìš©, Noto Sans KRì€ í•œê¸€ ëŒ€ì²´ */
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* AI ìƒì„± ì¤‘ ë²„íŠ¼ ì• ë‹ˆë©”ì´ì…˜ */
        .ai-generating::after {
            content: '.';
            animation: dots 1s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% {
                color: rgba(0,0,0,0);
                text-shadow:
                    .25em 0 0 rgba(0,0,0,0),
                    .5em 0 0 rgba(0,0,0,0);
            }
            40% {
                color: white;
                text-shadow:
                    .25em 0 0 rgba(0,0,0,0),
                    .5em 0 0 rgba(0,0,0,0);
            }
            60% {
                text-shadow:
                    .25em 0 0 white,
                    .5em 0 0 rgba(0,0,0,0);
            }
            80%, 100% {
                text-shadow:
                    .25em 0 0 white,
                    .5em 0 0 white;
            }
        }
        
        /* ì»¤ìŠ¤í…€ í¬ì»¤ìŠ¤ ë§ */
        input:focus, textarea:focus {
            outline: none;
            border-color: #4f46e5; /* indigo-600 */
            box-shadow: 0 0 0 2px #c7d2fe; /* indigo-200 */
        }

        /* ê²°ê³¼ í˜ì´ì§€ ì œëª© ì•„ì´ì½˜ ìƒ‰ìƒ */
        .result-group-icon {
            color: #8B5CF6; /* ë³´ë¼ìƒ‰ ê³„ì—´ */
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <div class="container mx-auto max-w-3xl p-4 sm:p-8">
        
        <!-- í—¤ë” -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-900">ì‘ì€ë„ì„œê´€ ë¸Œëœë“œ ì„¸íŒ…</h1>
            <p class="text-lg text-gray-600 mt-2">ë‹¹ì‹ ì˜ ë„ì„œê´€ì„ ìœ„í•œ ê³ ìœ í•œ ì•„ì´ë´í‹°í‹°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.</p>
        </header>

        
        <!-- ì§„í–‰ ìƒí™© -->
        <div id="progress-bar-container" class="mb-8">
            <div class="flex justify-between text-sm text-gray-600 mb-2">
                <span>ì§„í–‰ ìƒí™©</span>
                <span id="progress-text" class="font-medium text-indigo-600">1 / 10</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5">
                <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full transition-all duration-300" style="width: 10%"></div>
            </div>
        </div>

        
        <!-- ì§ˆë¬¸ ì„¹ì…˜ -->
        <main id="question-section" class="bg-white p-6 sm:p-8 rounded-lg shadow-md">
            
            <!-- *** ì•ˆë‚´ ë¬¸êµ¬ ìœ„ì¹˜ ì´ë™: ì´ ë¸”ë¡ì„ ì‚­ì œí•©ë‹ˆë‹¤. *** -->
            
            <!-- ì§ˆë¬¸ì´ ë Œë”ë§ë  ì»¨í…Œì´ë„ˆ -->
            <div id="question-container"></div>

            
            <!-- í•„ìˆ˜ í•­ëª© ì—ëŸ¬ ë©”ì‹œì§€ -->
            <div id="error-message" class="text-red-600 text-sm mt-4 font-medium hidden">
                <!-- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
            </div>

            
            <!-- AI ì—ëŸ¬ ë©”ì‹œì§€ (ë¡œì»¬ í…œí”Œë¦¿ì´ë¼ í˜„ì¬ ì‚¬ìš© ì•ˆí•¨) -->
            <div id="ai-error-message" class="mt-4 p-3 bg-red-50 text-red-700 rounded-lg hidden">
                <!-- AI ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
            </div>
        </main>

        
        <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
        <nav id="navigation-section" class="flex justify-between mt-8">
            <button id="prev-btn" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                ì´ì „
            </button>
            <button id="next-btn" class="px-6 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors">
                ë‹¤ìŒ
            </button>
        </nav>

        
        <!-- ê²°ê³¼ í˜ì´ì§€ ì„¹ì…˜ -->
        <section id="result-section" class="bg-white p-6 sm:p-8 rounded-lg shadow-md hidden">
            <!-- ì´ë¯¸ì§€ ìº¡ì²˜ ì˜ì—­ -->
            <div id="result-content-to-capture">
                <h2 class="text-3xl font-bold text-center text-indigo-900 mb-2">ğŸ‰ ë¸Œëœë“œ ì„¸íŒ… ì™„ë£Œ!</h2>
                <p class="text-center text-gray-600 mb-8">ë„ì„œê´€ì˜ ë¸Œëœë“œ ì•„ì´ë´í‹°í‹°ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤</p>
                
                <div id="result-container" class="space-y-8">
                    <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ë²„íŠ¼ ì˜ì—­ -->
            <div class="text-center mt-10 space-y-4">
                <button id="save-image-btn" class="px-8 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors">
                    <i class="fas fa-image mr-2"></i> ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸° (JPG)
                </button>
                <div id="image-save-guide" class="text-sm text-gray-500">
                    <p>ğŸ’¡ <strong>ì´ë¯¸ì§€ ì €ì¥ ì•ˆë‚´</strong></p>
                    <p>â€¢ PC: ë‹¤ìš´ë¡œë“œ í´ë”ì— JPG íŒŒì¼ë¡œ ìë™ ì €ì¥ë©ë‹ˆë‹¤.</p>
                    <p>â€¢ ìŠ¤ë§ˆíŠ¸í°: ê°¤ëŸ¬ë¦¬/ì‚¬ì§„ ì•±ì— ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</p>
                    <p class="mt-1">íŒŒì¼ëª…: <strong>[ë„ì„œê´€ëª…]_ë¸Œëœë“œê°€ì´ë“œ_[ë‚ ì§œ].jpg</strong></p>
                </div>
                <button id="restart-btn" class="px-8 py-3 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition-colors">
                    ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ê¸°
                </button>
            </div>
        </section>
    </div>

    <script>
        // --- 1. ìƒíƒœ ê´€ë¦¬ ---
        let currentStep = 0;
        const brandData = {};
        
        // !!! ì¤‘ìš”: ì—¬ê¸°ì— 2ë‹¨ê³„ì—ì„œ ë³µì‚¬í•œ Google Apps Script ì›¹ ì•± URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. !!!
        const GOOGLE_SHEET_WEB_APP_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE'; 
        // ì˜ˆ: 'https://script.google.com/macros/s/AKfycb.../exec'

        // --- 2. ì§ˆë¬¸ ë°ì´í„° ---
        const questions = [
            // ë„ì„œê´€ ê¸°ë³¸ ì •ë³´
            {
                id: 'library_name',
                group: 'ë„ì„œê´€ ê¸°ë³¸ ì •ë³´',
                icon: 'fas fa-building',
                question: 'ë„ì„œê´€ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
                description: 'ì§€ì—­ì„±ê³¼ ìƒì§•ì„±ì„ ë°˜ì˜í•œ ì´ë¦„ì„ ì§€ì–´ì£¼ì„¸ìš”. ë³„ì¹­ì´ë‚˜ ìƒì§• ìºë¦­í„°ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
                type: 'text',
                placeholder: 'ì˜ˆ: í–‡ì‚´ì‘ì€ë„ì„œê´€, ë§ˆì„ìˆ²ë¶ì¹´í˜',
                aiEnabled: false,
                required: true
            },
            {
                id: 'location',
                group: 'ë„ì„œê´€ ê¸°ë³¸ ì •ë³´',
                icon: 'fas fa-map-marker-alt',
                question: 'ë„ì„œê´€ì´ ìœ„ì¹˜í•œ ì§€ì—­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
                description: 'êµ¬ì²´ì ì¸ ì£¼ì†Œë‚˜ ì§€ì—­ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
                type: 'text',
                placeholder: 'ì˜ˆ: ì„œìš¸ì‹œ ì„±ë¶êµ¬, ìš°ë¦¬ë§ˆì„ ë¬¸í™”íšŒê´€ 2ì¸µ',
                aiEnabled: false,
                required: true
            },
            // í•µì‹¬ ì² í•™(Core Philosophy)
            {
                id: 'mission',
                group: 'í•µì‹¬ ì² í•™',
                icon: 'fas fa-lightbulb',
                question: "ë„ì„œê´€ì´ 'ë¬´ì—‡ì„ ìœ„í•´ ì¡´ì¬í•˜ëŠ”ì§€' (ë¯¸ì…˜) ì„¤ëª…í•´ì£¼ì„¸ìš”.",
                description: 'ë„ì„œê´€ì˜ ì¡´ì¬ ëª©ì ê³¼ ì‚¬ëª…ì„ ëª…í™•íˆ í‘œí˜„í•´ì£¼ì„¸ìš”.',
                type: 'textarea',
                placeholder: 'ì˜ˆ: "ì§€ì—­ ì£¼ë¯¼ì˜ ì‚¶ì„ í’ìš”ë¡­ê²Œ í•˜ëŠ” ì§€ì‹ê³¼ ë§Œë‚¨ì˜ ê³µê°„."',
                aiEnabled: true,
                example: 'ì˜ˆ: â€œì§€ì—­ ì£¼ë¯¼ì˜ ì‚¶ì„ í’ìš”ë¡­ê²Œ í•˜ëŠ” ì§€ì‹ê³¼ ë§Œë‚¨ì˜ ê³µê°„.â€'
            },
            {
                id: 'vision',
                group: 'í•µì‹¬ ì² í•™',
                icon: 'fas fa-bullseye',
                question: "'ì–´ë–¤ ë„ì„œê´€ì´ ë˜ê³  ì‹¶ì€ì§€' (ë¹„ì „) ì„¤ëª…í•´ì£¼ì„¸ìš”.",
                description: 'ë„ì„œê´€ì´ ì§€í–¥í•˜ëŠ” ë¯¸ë˜ì˜ ëª¨ìŠµì„ ê·¸ë ¤ë³´ì„¸ìš”.',
                type: 'textarea',
                placeholder: 'ì˜ˆ: "ëª¨ë‘ì—ê²Œ ì—´ë ¤ ìˆëŠ” ì§€ì—­ì˜ ë¬¸í™” í”Œë«í¼."',
                aiEnabled: true,
                example: 'ì˜ˆ: â€œëª¨ë‘ì—ê²Œ ì—´ë ¤ ìˆëŠ” ì§€ì—­ì˜ ë¬¸í™” í”Œë«í¼.â€'
            },
            {
                id: 'core_values',
                group: 'í•µì‹¬ ì² í•™',
                icon: 'fas fa-hands-helping',
                question: 'ë„ì„œê´€ ìš´ì˜ì˜ ê¸°ì¤€ì´ ë˜ëŠ” í•µì‹¬ê°€ì¹˜(Core Values)ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.',
                description: 'ë„ì„œê´€ì˜ ëª¨ë“  í™œë™ê³¼ ê²°ì •ì˜ ê¸°ì¤€ì´ ë˜ëŠ” ê°€ì¹˜ë“¤ì…ë‹ˆë‹¤.',
                type: 'text',
                placeholder: 'ì˜ˆ: ê³µìœ , ë°°ì›€, ì—°ê²°, ì°½ì˜ì„±, í¬ìš©',
                aiEnabled: true,
                example: 'ì˜ˆ: ê³µìœ (Sharing), ë°°ì›€(Learning), ì—°ê²°(Connection), ì°½ì˜ì„±(Creativity)'
            },
            // ë©”ì‹œì§€(Message)
            {
                id: 'slogan',
                group: 'ë©”ì‹œì§€',
                icon: 'fas fa-comment-dots',
                question: 'ê¸°ì–µì— ë‚¨ëŠ” ìŠ¬ë¡œê±´(Slogan)ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”.',
                description: 'ë„ì„œê´€ì„ ëŒ€í‘œí•˜ëŠ” ì§§ê³  ê°•ë ¥í•œ ë©”ì‹œì§€ì…ë‹ˆë‹¤.',
                type: 'text',
                placeholder: 'ì˜ˆ: "ì±…ìœ¼ë¡œ ì—¬ëŠ” ë‚´ì¼"',
                aiEnabled: true,
                example: 'ì˜ˆ: â€œì±…ìœ¼ë¡œ ì—¬ëŠ” ë‚´ì¼â€, â€œì‘ì€ ë„ì„œê´€, í° ì„¸ìƒ.â€'
            },
            // ìŠ¤í† ë¦¬(Storytelling)
            {
                id: 'about_library',
                group: 'ìŠ¤í† ë¦¬',
                icon: 'fas fa-book-reader',
                question: 'ë„ì„œê´€ì„ ì†Œê°œí•˜ëŠ” ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.',
                description: '3-5ë¬¸ë‹¨ìœ¼ë¡œ ë„ì„œê´€ì˜ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”.',
                type: 'textarea',
                placeholder: 'ì²« ë¬¸ë‹¨ì€ ì„¤ë¦½ ë°°ê²½, ì¤‘ê°„ì€ ìš´ì˜ ë°©í–¥, ë§ˆì§€ë§‰ì€ ì´ˆëŒ€ ë©”ì‹œì§€ë¥¼ ë‹´ì•„ë³´ì„¸ìš”.',
                aiEnabled: true
            },
            // ìš´ì˜ ë°©í–¥(Operations Alignment)
            {
                id: 'program_philosophy',
                group: 'ìš´ì˜ ë°©í–¥',
                icon: 'fas fa-cogs',
                question: 'êµìœ¡Â·ë¬¸í™”Â·ì»¤ë®¤ë‹ˆí‹° í”„ë¡œê·¸ë¨ì˜ ë°©í–¥ì„±ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.',
                description: 'í”„ë¡œê·¸ë¨ ê¸°íšê³¼ ìš´ì˜ì˜ ê¸°ë³¸ ë°©í–¥ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.',
                type: 'textarea',
                placeholder: 'ì˜ˆ: ë‹¨ìˆœ ì§€ì‹ ì „ë‹¬ì´ ì•„ë‹Œ, ì£¼ë¯¼ ê°„ì˜ ì†Œí†µê³¼ í˜‘ë ¥ì„ ì´ëŒì–´ë‚´ëŠ” ì°¸ì—¬í˜• í”„ë¡œê·¸ë¨ì„ ì§€í–¥í•©ë‹ˆë‹¤.',
                aiEnabled: true
            },
            {
                id: 'service_principles',
                group: 'ìš´ì˜ ë°©í–¥',
                icon: 'fas fa-handshake',
                question: 'ë„ì„œê´€ ì„œë¹„ìŠ¤ì˜ ê¸°ë³¸ ì›ì¹™ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.',
                description: 'ì§ì›ë“¤ì´ ì§€ì¼œì•¼ í•  ì„œë¹„ìŠ¤ í–‰ë™ì§€ì¹¨ì…ë‹ˆë‹¤.',
                type: 'textarea',
                placeholder: 'ì˜ˆ: ëª¨ë“  ì´ìš©ê°ì—ê²Œ ì¹œì ˆí•˜ê³  í‰ë“±í•˜ê²Œ, ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´ë¥¼ ì œê³µí•˜ë©°, í¸ì•ˆí•œ ì ‘ê·¼ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.',
                aiEnabled: true
            },
            {
                id: 'space_concept',
                group: 'ìš´ì˜ ë°©í–¥',
                icon: 'fas fa-drafting-compass',
                question: 'ë„ì„œê´€ ê³µê°„ì´ ì–´ë–¤ ëŠë‚Œì´ì—ˆìœ¼ë©´ ì¢‹ê² ë‚˜ìš”?',
                description: 'ë¬¼ë¦¬ì  ê³µê°„ì´ ë¸Œëœë“œ ì² í•™ì„ ì–´ë–»ê²Œ ë°˜ì˜í• ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.',
                type: 'textarea',
                placeholder: 'ì˜ˆ: ë”°ëœ»í•œ ì¡°ëª…ê³¼ ì›ëª© ê°€êµ¬ë¡œ "ìš°ë¦¬ì§‘ ì„œì¬" ê°™ì€ ì•„ëŠ‘í•¨ì„ ì—°ì¶œ. ì•„ì´ì™€ ì–´ë¥¸ì´ í•¨ê»˜ ì±…ì„ ì½ëŠ” ê³µê°„.',
                aiEnabled: true
            }
        ];
        
        // --- 3. DOM ìš”ì†Œ ---
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const questionContainer = document.getElementById('question-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const questionSection = document.getElementById('question-section');
        const navigationSection = document.getElementById('navigation-section');
        const resultSection = document.getElementById('result-section');
        const resultContainer = document.getElementById('result-container');
        const restartBtn = document.getElementById('restart-btn');
        const saveImageBtn = document.getElementById('save-image-btn');
        const errorMessage = document.getElementById('error-message');
        const aiErrorMessage = document.getElementById('ai-error-message');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const resultContentToCapture = document.getElementById('result-content-to-capture');

        // --- 4. ë Œë”ë§ í•¨ìˆ˜ ---
        function renderQuestion(stepIndex) {
            const q = questions[stepIndex];
            
            // *** ì¶”ê°€: ì²« ë²ˆì§¸ ì§ˆë¬¸ì¼ ë•Œë§Œ ì•ˆë‚´ ë¬¸êµ¬ ìƒì„± ***
            const welcomeMessage = stepIndex === 0
                ? `<div class="mb-6 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800">
                       <p>í™˜ì˜í•©ë‹ˆë‹¤! ì§€ê¸ˆë¶€í„° 10ê°œì˜ ì§ˆë¬¸ì„ í†µí•´ ë‹¹ì‹ ì˜ ë„ì„œê´€ì´ ê°€ì§„ ê³ ìœ í•œ ë§¤ë ¥ê³¼ ì² í•™ì„ ë°œê²¬í•˜ëŠ” ì—¬ì •ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì²œì²œíˆ ë‹µë³€í•˜ë©° ìš°ë¦¬ ë„ì„œê´€ë§Œì˜ ë©‹ì§„ ë¸Œëœë“œë¥¼ ì™„ì„±í•´ë³´ì„¸ìš”! (AI ë²„íŠ¼ìœ¼ë¡œ ì•„ì´ë””ì–´ë¥¼ ì–»ì„ ìˆ˜ë„ ìˆì–´ìš” ğŸ˜‰)</p>
                   </div>`
                : ''; // ì²« ë²ˆì§¸ ì§ˆë¬¸ì´ ì•„ë‹ˆë©´ ë¹ˆ ë¬¸ìì—´

            // ì…ë ¥ í•„ë“œ HTML
            const inputElement = q.type === 'textarea'
                ? `<textarea id="answer-input" class="w-full h-32 p-3 border border-gray-300 rounded-lg transition-colors duration-200" placeholder="${q.placeholder || ''}"></textarea>`
                : `<input type="text" id="answer-input" class="w-full p-3 border border-gray-300 rounded-lg transition-colors duration-200" placeholder="${q.placeholder || ''}">`;

            // ì˜ˆì‹œ HTML
            const exampleElement = q.example
                ? `<p class="text-sm text-gray-500 mt-2">${q.example}</p>`
                : '';

            // AI ë²„íŠ¼ HTML
            const aiButtonElement = q.aiEnabled
                ? `<button id="ai-generate-btn" class="mt-4 px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors disabled:bg-gray-400">
                       ğŸ¤– AIë¡œ ì‘ì„±í•˜ê¸°
                   </button>`
                : '';

            // ì§ˆë¬¸ ì»¨í…Œì´ë„ˆ ì±„ìš°ê¸°
            questionContainer.innerHTML = `
                ${welcomeMessage} <!-- *** ì—¬ê¸°ì— ì•ˆë‚´ ë¬¸êµ¬ ë³€ìˆ˜ ì¶”ê°€ *** -->

                <div class="mb-2">
                    <span class="text-sm font-medium text-indigo-600">${q.group}</span>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-3">${q.question}</h2>
                <p class="text-gray-600 mb-4">${q.description}</p>
                
                ${inputElement}
                ${exampleElement}
                ${aiButtonElement}
            `;

            // ê¸°ì¡´ ë‹µë³€ì´ ìˆìœ¼ë©´ ì±„ìš°ê¸°
            const answerInput = document.getElementById('answer-input');
            if (brandData[q.id]) {
                answerInput.value = brandData[q.id];
            }

            // AI ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ìˆëŠ” ê²½ìš°)
            if (q.aiEnabled) {
                document.getElementById('ai-generate-btn').addEventListener('click', handleAiGenerate);
            }

            // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
            updateProgress();
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            prevBtn.disabled = stepIndex === 0;
            if (stepIndex === questions.length - 1) {
                nextBtn.textContent = 'ì™„ë£Œ';
                nextBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                nextBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            } else {
                nextBtn.textContent = 'ë‹¤ìŒ';
                nextBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                nextBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
            }

            // ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            hideError(errorMessage);
            hideError(aiErrorMessage);
        }

        function updateProgress() {
            const progress = ((currentStep + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${currentStep + 1} / ${questions.length}`;
        }
        
        function showResultPage() {
            // í˜„ì¬ ë‹¨ê³„ì˜ ë‹µë³€ ì €ì¥ (ë§ˆì§€ë§‰ ë‹¨ê³„ ë‹µë³€ ì €ì¥)
            saveAnswer(); 
            
            // UI ì „í™˜
            questionSection.classList.add('hidden');
            navigationSection.classList.add('hidden');
            progressBarContainer.classList.add('hidden');
            resultSection.classList.remove('hidden');
            
            // ê²°ê³¼ HTML ìƒì„±
            resultContainer.innerHTML = ''; // ì´ˆê¸°í™”
            let currentGroup = '';

            questions.forEach(q => {
                const answer = brandData[q.id] || 'ë¯¸ë‹µë³€'; // ë‹µë³€ ì—†ìœ¼ë©´ 'ë¯¸ë‹µë³€' í‘œì‹œ
                
                // ê·¸ë£¹ íƒ€ì´í‹€ ë³€ê²½ ì‹œ
                if (q.group !== currentGroup) {
                    currentGroup = q.group;
                    resultContainer.innerHTML += `
                        <div class="pt-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <i class="${q.icon || 'fas fa-info-circle'} result-group-icon mr-2"></i> ${currentGroup}
                            </h3>
                            <div class="space-y-4">
                    `;
                }

                // ë‹µë³€ ë‚´ìš© ì¶”ê°€
                resultContainer.innerHTML += `
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <p class="font-semibold text-gray-700">${q.question.split('(')[0].trim()}</p>
                        <p class="text-gray-800 mt-1 whitespace-pre-wrap">${answer}</p>
                    </div>
                `;

                // ë‹¤ìŒ ì§ˆë¬¸ì´ ë‹¤ë¥¸ ê·¸ë£¹ì¸ì§€ í™•ì¸
                const nextQuestion = questions[questions.indexOf(q) + 1];
                if (!nextQuestion || nextQuestion.group !== currentGroup) {
                    resultContainer.innerHTML += `</div></div>`; // ê·¸ë£¹ ë‹«ê¸°
                }
            });

            window.scrollTo(0, 0);
        }

        // --- 5. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
        async function handleNext() { // 'async' í‚¤ì›Œë“œ ì¶”ê°€
            // ìœ íš¨ì„± ê²€ì‚¬
            if (!validateInput()) {
                return;
            }
            
            // ë‹µë³€ ì €ì¥
            saveAnswer();

            // ë‹¤ìŒ ë‹¨ê³„ë¡œ
            if (currentStep < questions.length - 1) {
                currentStep++;
                renderQuestion(currentStep);
                window.scrollTo(0, 0);
            } else {
                // ì™„ë£Œ - Google Sheetì— ì €ì¥
                if (GOOGLE_SHEET_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE' || GOOGLE_SHEET_WEB_APP_URL === '') {
                    // URLì´ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°, ë°”ë¡œ ê²°ê³¼ í˜ì´ì§€ë§Œ í‘œì‹œ
                    console.warn('Google Sheet URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê²°ê³¼ëŠ” ì €ì¥ë˜ì§€ ì•Šê³  í˜ì´ì§€ë§Œ í‘œì‹œë©ë‹ˆë‹¤.');
                    showResultPage();
                    return;
                }
                
                // ë²„íŠ¼ ë¡œë”© ìƒíƒœ ë³€ê²½
                nextBtn.disabled = true;
                nextBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Google Sheetì— ì €ì¥ ì¤‘...';

                try {
                    // Google Sheetì— ì €ì¥ ì‹œë„
                    await saveToGoogleSheet(brandData);
                    
                    // ì„±ê³µ ì‹œ ê²°ê³¼ í˜ì´ì§€ í‘œì‹œ
                    // (ë²„íŠ¼ì€ ê²°ê³¼ í˜ì´ì§€ì—ì„œ 'ë‹¤ì‹œ ì‹œì‘í•˜ê¸°'ë¡œ ë°”ë€Œë¯€ë¡œ ì›ìƒë³µêµ¬ í•„ìš” ì—†ìŒ)
                    showResultPage();

                } catch (error) {
                    // ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì•Œë¦¼
                    console.error('Google Sheet ì €ì¥ ì‹¤íŒ¨:', error);
                    alert('Google Sheetì— ì €ì¥í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”. (ê²°ê³¼ëŠ” ì €ì¥ë˜ì§€ ì•Šì•˜ì§€ë§Œ, í˜ì´ì§€ëŠ” í‘œì‹œë©ë‹ˆë‹¤.)');
                    
                    // ì €ì¥ì€ ì‹¤íŒ¨í–ˆë”ë¼ë„ ê²°ê³¼ í˜ì´ì§€ëŠ” ë³´ì—¬ì¤Œ
                    showResultPage(); 
                    
                    // ë²„íŠ¼ ì›ìƒ ë³µêµ¬ (ê²°ê³¼ í˜ì´ì§€ì—ì„œ 'ë‹¤ì‹œ ì‹œì‘í•˜ê¸°' ë²„íŠ¼ì´ ìˆìœ¼ë¯€ë¡œ, nextBtnì„ ë³µêµ¬í•  í•„ìš”ëŠ” ì—†ìŒ)
                }
            }
        }

        function handlePrev() {
            // í˜„ì¬ ë‹µë³€ ì €ì¥ (ìˆ˜ì •í–ˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ)
            saveAnswer();

            // ì´ì „ ë‹¨ê³„ë¡œ
            if (currentStep > 0) {
                currentStep--;
                renderQuestion(currentStep);
                window.scrollTo(0, 0);
            }
        }
        
        function restartApp() {
            // ìƒíƒœ ì´ˆê¸°í™”
            currentStep = 0;
            for (const key in brandData) {
                delete brandData[key];
            }
            
            // UI ì „í™˜
            resultSection.classList.add('hidden');
            questionSection.classList.remove('hidden');
            navigationSection.classList.remove('hidden');
            progressBarContainer.classList.remove('hidden');

            // ì²« ë²ˆì§¸ ì§ˆë¬¸ ë Œë”ë§
            renderQuestion(currentStep);
            window.scrollTo(0, 0);
        }
        
        function saveAnswer() {
            const q = questions[currentStep];
            const answerInput = document.getElementById('answer-input');
            if(answerInput) { // answerInputì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ (ê²°ê³¼ í˜ì´ì§€ ì „í™˜ ì‹œ null ë°©ì§€)
                brandData[q.id] = answerInput.value.trim();
            }
        }

        function validateInput() {
            const q = questions[currentStep];
            const answerInput = document.getElementById('answer-input');
            const value = answerInput.value.trim();

            if (q.required && value === '') {
                showError(errorMessage, 'í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤. ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                answerInput.classList.add('border-red-500');
                return false;
            }
            
            hideError(errorMessage);
            answerInput.classList.remove('border-red-500');
            return true;
        }

        function showError(element, message) {
            element.textContent = message;
            element.classList.remove('hidden');
        }

        function hideError(element) {
            element.textContent = '';
            element.classList.add('hidden');
        }

        // --- 6. ì´ë¯¸ì§€ ì €ì¥ ê¸°ëŠ¥ (html2canvas) ---
        async function saveAsJPG() {
            saveImageBtn.disabled = true;
            saveImageBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> ì´ë¯¸ì§€ ìƒì„± ì¤‘...';

            const element = resultContentToCapture; // ê²°ê³¼ ì»¨í…Œì´ë„ˆ ì „ì²´ë¥¼ ìº¡ì²˜
            
            try {
                const canvas = await html2canvas(element, {
                    scale: 2, // ê³ í•´ìƒë„ ì´ë¯¸ì§€ ìƒì„±ì„ ìœ„í•´ ìŠ¤ì¼€ì¼ ì¦ê°€
                    useCORS: true, // ì™¸ë¶€ ì´ë¯¸ì§€ ì‚¬ìš© ì‹œ CORS í—ˆìš©
                    logging: false // ì½˜ì†” ë¡œê¹… ë¹„í™œì„±í™”
                });

                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                const libraryName = brandData.library_name ? brandData.library_name.replace(/[^a-zA-Z0-9ê°€-í£]/g, '_') : 'ì‘ì€ë„ì„œê´€';
                const filename = `${libraryName}_ë¸Œëœë“œê°€ì´ë“œ_${year}${month}${day}.jpg`;

                // ëª¨ë°”ì¼/PC í™˜ê²½ì— ë”°ë¼ ì²˜ë¦¬
                if (/(android|iphone|ipad|ipod)/i.test(navigator.userAgent)) {
                    // ëª¨ë°”ì¼: ìƒˆ íƒ­ì—ì„œ ì´ë¯¸ì§€ ì—´ê¸° (ì‚¬ìš©ìê°€ ì§ì ‘ ì €ì¥)
                    const imgData = canvas.toDataURL('image/jpeg', 0.9);
                    const newWindow = window.open();
                    newWindow.document.write(`<img src="${imgData}" style="max-width:100%; height:auto;">`);
                    newWindow.document.title = filename;
                    newWindow.document.body.style.margin = '0';
                    newWindow.document.body.style.display = 'flex';
                    newWindow.document.body.style.justifyContent = 'center';
                    newWindow.document.body.style.alignItems = 'center';
                    alert('ì´ë¯¸ì§€ê°€ ìƒˆ íƒ­ì— ì—´ë ¸ìŠµë‹ˆë‹¤. ê¸¸ê²Œ ëˆŒëŸ¬ ì €ì¥í•˜ê±°ë‚˜ ìŠ¤í¬ë¦°ìƒ· ê¸°ëŠ¥ì„ ì´ìš©í•´ ì£¼ì„¸ìš”.');
                } else {
                    // PC: ë°”ë¡œ ë‹¤ìš´ë¡œë“œ
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL('image/jpeg', 0.9);
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    alert('ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }
            } catch (error) {
                console.error("ì´ë¯¸ì§€ ì €ì¥ ì‹¤íŒ¨:", error);
                alert("ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
            } finally {
                saveImageBtn.disabled = false;
                saveImageBtn.innerHTML = '<i class="fas fa-image mr-2"></i> ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸° (JPG)';
            }
        }


        // --- Google Sheet ì €ì¥ í•¨ìˆ˜ ì¶”ê°€ ---
        async function saveToGoogleSheet(data) {
            // ë°ì´í„°ë¥¼ Apps Scriptë¡œ ì „ì†¡í•©ë‹ˆë‹¤.
            // 'no-cors' ëª¨ë“œëŠ” ì‘ë‹µì„ ë°›ì§€ ì•Šì§€ë§Œ, Google Apps Scriptì˜ ë¦¬ë””ë ‰ì…˜ì„ ìš°íšŒí•˜ê³ 
            // ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡(fire and forget)í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.
            // Apps ScriptëŠ” ë°ì´í„°ë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.
            
            console.log('Sending data to Google Sheet:', data);
            
            await fetch(GOOGLE_SHEET_WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors', // 'no-cors' ëª¨ë“œë¡œ ë³€ê²½í•˜ì—¬ CORS ë° ë¦¬ë””ë ‰ì…˜ ì˜¤ë¥˜ ë°©ì§€
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            // 'no-cors' ëª¨ë“œì—ì„œëŠ” ì‘ë‹µì„ í™•ì¸í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, 
            // ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆë‹¤ê³  ê°€ì •í•˜ê³  ë°”ë¡œ ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
            console.log('Google Sheetë¡œ ë°ì´í„° ì „ì†¡ ìš”ì²­ ì™„ë£Œ.');
            return { status: 'success' };
        }


        // --- 7. AI ê¸°ëŠ¥ (ë¡œì»¬ í…œí”Œë¦¿ ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •) ---

        // AI í…œí”Œë¦¿ ë°ì´í„°
        const aiTemplates = {
            mission: [
                "ì§€ì—­ ì£¼ë¯¼ì˜ ì‚¶ì„ í’ìš”ë¡­ê²Œ í•˜ëŠ” ì§€ì‹ê³¼ ë§Œë‚¨ì˜ ê³µê°„.",
                "ì±…ì„ í†µí•´ ì„¸ìƒì„ ì—°ê²°í•˜ê³ , ë°°ì›€ì„ í†µí•´ ë¯¸ë˜ë¥¼ ì—¬ëŠ” ë§ˆì„ì˜ ì‚¬ë‘ë°©.",
                "ëª¨ë“  ì„¸ëŒ€ê°€ ì§€í˜œë¥¼ ë‚˜ëˆ„ê³  ê¿ˆì„ í‚¤ìš°ëŠ”, ìš°ë¦¬ ë™ë„¤ ë¬¸í™” ë°œì „ì†Œ."
            ],
            vision: [
                "ëª¨ë‘ì—ê²Œ ì—´ë ¤ ìˆëŠ” ì§€ì—­ì˜ ë¬¸í™” í”Œë«í¼.",
                "ì‚¬ëŒê³¼ ì´ì•¼ê¸°ê°€ ë§Œë‚˜ ì°½ì˜ì„±ì´ ìƒ˜ì†ŸëŠ”, ì§€ì—­ ì»¤ë®¤ë‹ˆí‹°ì˜ ì¤‘ì‹¬.",
                "ì–¸ì œë‚˜ ì°¾ê³  ì‹¶ì€, ì§‘ì²˜ëŸ¼ í¸ì•ˆí•˜ê³  ì§€í˜œë¡œ ê°€ë“ ì°¬ ê³µê°„."
            ],
            core_values: [
                "ê³µìœ (Sharing), ë°°ì›€(Learning), ì—°ê²°(Connection), ì°½ì˜ì„±(Creativity)",
                "í™˜ëŒ€(Welcome), ì†Œí†µ(Communication), ì„±ì¥(Growth), í¬ìš©(Inclusion)",
                "ê°œë°©(Openness), í˜‘ë ¥(Cooperation), ì§€ì—­ì„±(Community), ì¦ê±°ì›€(Joy)"
            ],
            slogan: [
                "ì±…ìœ¼ë¡œ ì—¬ëŠ” ë‚´ì¼",
                "ì‘ì€ ë„ì„œê´€, í° ì„¸ìƒ",
                "ë§ˆì„ì„ í’ˆë‹¤, ì±…ì„ í´ë‹¤",
                "ì´ì•¼ê¸°ê°€ ê½ƒí”¼ëŠ”, ìš°ë¦¬ ë™ë„¤ ì„œì¬"
            ],
            about_library: [
                "ì´ê³³ì€ ì±…ê³¼ ì‚¬ëŒ, ê·¸ë¦¬ê³  ì´ì•¼ê¸°ê°€ ë§Œë‚˜ëŠ” ë”°ëœ»í•œ ê³µê°„ì…ë‹ˆë‹¤.\n\nìš°ë¦¬ ë„ì„œê´€ì€ ë‹¨ìˆœíˆ ì±…ì„ ë¹Œë ¤ì£¼ëŠ” ê³³ì„ ë„˜ì–´, ì§€ì‹ê³¼ ê²½í—˜ì„ ë‚˜ëˆ„ê³  ì„œë¡œì˜ ì„±ì¥ì„ ê³ì—ì„œ ì‘ì›í•˜ëŠ” ì§€ì—­ ê³µë™ì²´ì˜ êµ¬ì‹¬ì ì…ë‹ˆë‹¤.\n\nì–¸ì œë“  í¸ì•ˆí•˜ê²Œ ë“¤ëŸ¬ ì§€í˜œì˜ ìƒ˜ë¬¼ì„ ë§ˆì‹œê³ , ì´ì›ƒê³¼ ë”°ëœ»í•œ ì •ì„ ë‚˜ëˆ„ëŠ” ë‹¹ì‹ ì˜ ê³µê°„ì´ ë˜ê² ìŠµë‹ˆë‹¤.",
                "[ë„ì„œê´€ëª…]ì€(ëŠ”) [ì§€ì—­ëª…]ì˜ í•œê°€ìš´ë°, ì£¼ë¯¼ë“¤ì˜ ìë°œì ì¸ ì°¸ì—¬ë¡œ í”¼ì–´ë‚œ ë¬¸í™”ì˜ ê½ƒì…ë‹ˆë‹¤.\n\nìš°ë¦¬ëŠ” ëª¨ë“  ì„¸ëŒ€ê°€ í•¨ê»˜ ì–´ìš°ëŸ¬ì ¸ ì±…ì„ ì½ê³ , í† ë¡ í•˜ë©°, ìƒˆë¡œìš´ ë¬¸í™”ë¥¼ ë§Œë“¤ì–´ê°€ëŠ” 'ë§ˆì„ì˜ ê±°ì‹¤'ì„ ê¿ˆê¿‰ë‹ˆë‹¤. ì•„ì´ë“¤ì˜ ì›ƒìŒì†Œë¦¬ì™€ ì–´ë¥¸ë“¤ì˜ ì§€í˜œê°€ ê³µì¡´í•˜ëŠ” ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ ì¼ìƒì´ ë” í’ìš”ë¡œì›Œì§€ê¸¸ ë°”ëë‹ˆë‹¤.\n\nì§€ì‹ì´ í•„ìš”í•  ë•Œ, ì¹œêµ¬ê°€ ê·¸ë¦¬ìš¸ ë•Œ, ì–¸ì œë“  í¸ì•ˆí•˜ê²Œ ì°¾ì•„ì£¼ì„¸ìš”.",
                "ì±… í•œ ê¶Œì— ë‹´ê¸´ ìš°ì£¼ë¥¼ ì—¬í–‰í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [ë„ì„œê´€ëª…]ì€(ëŠ”) ë°”ë¡œ ê·¸ ì—¬í–‰ì˜ ì¶œë°œì ì…ë‹ˆë‹¤.\n\nìš°ë¦¬ëŠ” ì±…ì„ ë§¤ê°œë¡œ ì‚¬ëŒê³¼ ì‚¬ëŒì„ ì‡ê³ , ë‹¤ì–‘í•œ ë¬¸í™” í”„ë¡œê·¸ë¨ì„ í†µí•´ ì‚¶ì˜ í™œë ¥ì„ ë¶ˆì–´ë„£ê³ ì í•©ë‹ˆë‹¤. ì§€ì‹ì˜ ë‚˜ëˆ”ì´ ì¼ìƒì´ ë˜ê³ , ë¬¸í™”ì˜ í–¥ìœ ê°€ ìŠµê´€ì´ ë˜ëŠ” ê³³, [ë„ì„œê´€ëª…]ì—ì„œ ë‹¹ì‹ ì˜ ìƒˆë¡œìš´ ì´ì•¼ê¸°ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”."
            ],
            program_philosophy: [
                "ë‹¨ìˆœí•œ ì§€ì‹ ì „ë‹¬ì„ ë„˜ì–´, ì£¼ë¯¼ ê°„ì˜ ì†Œí†µê³¼ í˜‘ë ¥ì„ ì´ëŒì–´ë‚´ëŠ” ì°¸ì—¬í˜• í”„ë¡œê·¸ë¨ì„ ì§€í–¥í•©ë‹ˆë‹¤.",
                "ì „ ì„¸ëŒ€ë¥¼ ì•„ìš°ë¥´ëŠ” í‰ìƒí•™ìŠµì˜ ê¸°íšŒë¥¼ ì œê³µí•˜ë©°, ë…ì„œì˜ ì¦ê±°ì›€ì„ ì‚¶ì˜ ì¼ë¶€ë¡œ ë§Œë“­ë‹ˆë‹¤.",
                "ì§€ì—­ì˜ íŠ¹ìƒ‰ì„ ë°˜ì˜í•œ ë¬¸í™” ì˜ˆìˆ  í”„ë¡œê·¸ë¨ì„ í†µí•´, ì¼ìƒ ì† ì°½ì˜ì„±ì„ ë°œê²¬í•˜ë„ë¡ ë•ìŠµë‹ˆë‹¤."
            ],
            service_principles: [
                "ëª¨ë“  ì´ìš©ê°ì—ê²Œ ì¹œì ˆí•˜ê³  í‰ë“±í•˜ê²Œ, ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´ë¥¼ ì œê³µí•˜ë©°, í¸ì•ˆí•œ ì ‘ê·¼ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.",
                "ë”°ëœ»í•œ ë¯¸ì†Œë¡œ ë§ì´í•˜ê³ , ì´ìš©ìì˜ ëª©ì†Œë¦¬ì— ê·€ ê¸°ìš¸ì´ë©°, ì–¸ì œë‚˜ ê¹¨ë—í•˜ê³  ì¾Œì í•œ í™˜ê²½ì„ ìœ ì§€í•©ë‹ˆë‹¤.",
                "ì „ë¬¸ì„±ì„ ë°”íƒ•ìœ¼ë¡œ ì •í™•í•œ ì •ë³´ë¥¼ ì œê³µí•˜ë©°, ëª¨ë“  ì„¸ëŒ€ê°€ í¸ì•ˆí•˜ê²Œ ë¨¸ë¬¼ ìˆ˜ ìˆëŠ” í¬ìš©ì ì¸ ê³µê°„ì„ ë§Œë“­ë‹ˆë‹¤."
            ],
            space_concept: [
                "ë”°ëœ»í•œ ì¡°ëª…ê³¼ ì›ëª© ê°€êµ¬ë¡œ 'ìš°ë¦¬ì§‘ ì„œì¬' ê°™ì€ ì•„ëŠ‘í•¨ì„ ì—°ì¶œ. ì•„ì´ì™€ ì–´ë¥¸ì´ í•¨ê»˜ ì±…ì„ ì½ëŠ” ê³µê°„.",
                "í†µìœ ë¦¬ì°½ìœ¼ë¡œ í–‡ì‚´ì´ ê°€ë“ ë“¤ì–´ì˜¤ëŠ” ë°ê³  ê°œë°©ì ì¸ ê³µê°„. ììœ ë¡­ê²Œ í† ë¡ í•  ìˆ˜ ìˆëŠ” ì»¤ë®¤ë‹ˆí‹° í…Œì´ë¸”ì„ ì¤‘ì‹¬ìœ¼ë¡œ í•©ë‹ˆë‹¤.",
                "ì¡°ìš©íˆ ì§‘ì¤‘í•  ìˆ˜ ìˆëŠ” 1ì¸ìš© ì¢Œì„ê³¼, ì•„ì´ë“¤ì´ í¸ì•ˆí•˜ê²Œ ë’¹êµ´ë©° ì±…ì„ ë³¼ ìˆ˜ ìˆëŠ” ë§ˆë£¨ ê³µê°„ì„ ì¡°í™”ë¡­ê²Œ ë°°ì¹˜í•©ë‹ˆë‹¤."
            ]
        };

        // ë¡œì»¬ AI í…œí”Œë¦¿ ìƒì„± í•¨ìˆ˜
        function generateLocalAIContent(questionId) {
            const templates = aiTemplates[questionId];
            if (!templates || templates.length === 0) {
                return "AI ìƒì„± ì˜ˆì‹œì…ë‹ˆë‹¤. ì§ì ‘ ìˆ˜ì •í•´ì£¼ì„¸ìš”."; // Fallback
            }
            
            const answerInput = document.getElementById('answer-input');
            const currentValue = answerInput ? answerInput.value : '';
            
            if (templates.length === 1) {
                return templates[0]; // ì„ íƒì§€ê°€ í•˜ë‚˜ë¿ì´ë©´ ê·¸ëƒ¥ ë°˜í™˜
            }

            let newTemplate = currentValue;
            let attempts = 0;
            
            // 5ë²ˆ ì •ë„ ì‹œë„í•´ì„œ í˜„ì¬ ê°’ê³¼ ë‹¤ë¥¸ ê°’ì„ ì°¾ìŒ.
            while (newTemplate === currentValue && attempts < 5) {
                const randomIndex = Math.floor(Math.random() * templates.length);
                newTemplate = templates[randomIndex];
                attempts++;
            }
            
            // [ë„ì„œê´€ëª…], [ì§€ì—­ëª…] í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ì‹¤ì œ ê°’ìœ¼ë¡œ ì¹˜í™˜
            const libraryName = brandData.library_name || 'ìš°ë¦¬ ë„ì„œê´€';
            const location = brandData.location || 'ìš°ë¦¬ ë§ˆì„';
            
            newTemplate = newTemplate.replace(/\[ë„ì„œê´€ëª…\]/g, libraryName);
            newTemplate = newTemplate.replace(/\[ì§€ì—­ëª…\]/g, location);

            return newTemplate;
        }

        async function handleAiGenerate(e) {
            e.preventDefault();
            const aiBtn = e.target;
            const answerInput = document.getElementById('answer-input');
            const q = questions[currentStep];

            // ë¡œë”© ìƒíƒœ
            aiBtn.disabled = true;
            aiBtn.innerHTML = '<span class="ai-generating">ğŸ¤– ìƒì„± ì¤‘</span>';
            hideError(aiErrorMessage);

            // ë¡œì»¬ í…œí”Œë¦¿ ìƒì„±
            const aiText = generateLocalAIContent(q.id);

            // 300ms ë”œë ˆì´ë¥¼ ì£¼ì–´ "ìƒì„± ì¤‘" ëŠë‚Œì„ ì¤Œ (ì‚¬ìš©ì ê²½í—˜)
            setTimeout(() => {
                answerInput.value = aiText;
                saveAnswer(); // AIê°€ ìƒì„±í•œ ë‹µì„ ì¦‰ì‹œ ì €ì¥
                
                // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
                aiBtn.disabled = false;
                aiBtn.innerHTML = 'ğŸ¤– AIë¡œ ì‘ì„±í•˜ê¸°';
            }, 300);
        }
        
        // --- 8. ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuestion(currentStep);
            
            nextBtn.addEventListener('click', handleNext);
            prevBtn.addEventListener('click', handlePrev);
            restartBtn.addEventListener('click', restartApp);
            saveImageBtn.addEventListener('click', saveAsJPG);
        });
    </script>
</body>
</html>


